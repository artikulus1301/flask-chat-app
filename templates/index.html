{% extends 'base.html' %}

{% block title %}–ì–ª–∞–≤–Ω—ã–π —á–∞—Ç ‚Äî Secure Chat{% endblock %}

{% block content %}
<div class="chat-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- –ì—Ä—É–ø–ø—ã -->
        <div class="sidebar-section">
            <h3>–ì—Ä—É–ø–ø—ã</h3>
            <div class="groups-list" id="groups-list">
                <div class="group-item active" data-group-id="general">
                    <span class="group-icon">üí¨</span>
                    <span class="group-name">–û–±—â–∏–π —á–∞—Ç</span>
                </div>
                <!-- –ì—Ä—É–ø–ø—ã –±—É–¥—É—Ç –ø–æ–¥–≥—Ä—É–∂–∞—Ç—å—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
            <button id="create-group-btn" class="btn-create-group">+ –°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
        </div>

        <!-- –û–Ω–ª–∞–π–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ -->
        <div class="sidebar-section">
            <h3>–û–Ω–ª–∞–π–Ω <span id="online-users-count">0</span></h3>
            <div class="users-list" id="online-users-list">
                <!-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ WebSocket -->
            </div>
        </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å —á–∞—Ç–∞ -->
    <div class="chat-area">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="chat-header">
            <h2 id="current-chat-name">üí¨ –û–±—â–∏–π —á–∞—Ç</h2>
            <div class="chat-info">
                <span id="typing-indicator"></span>
            </div>
        </div>

        <!-- –°–æ–æ–±—â–µ–Ω–∏—è -->
        <div class="messages-container">
            <div class="messages" id="messages">
                <div class="empty-state" id="empty-state">
                    <p>–ù–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                </div>
            </div>
        </div>

        <!-- –ü–æ–ª–µ –≤–≤–æ–¥–∞ -->
        <div class="message-input-container">
            <div class="input-tools">
                <button class="btn-tool" id="file-upload-btn" title="–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª">üìé</button>
                <button class="btn-tool" id="encryption-toggle" title="–í–∫–ª—é—á–∏—Ç—å —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ">üîì</button>
            </div>
            
            <div class="message-input-wrapper">
                <textarea 
                    id="message-input" 
                    placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." 
                    rows="1"
                    maxlength="2000"
                ></textarea>
                <button id="send-btn" class="btn-send" disabled>‚û§</button>
            </div>
            
            <div class="input-status">
                <span id="char-count">0/2000</span>
                <span id="encryption-status" class="encryption-off">–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤—ã–∫–ª—é—á–µ–Ω–æ</span>
            </div>
        </div>
    </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã -->
<div id="create-group-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É</h3>
            <span class="close-modal">&times;</span>
        </div>
        <div class="modal-body">
            <form id="create-group-form">
                <div class="form-group">
                    <label for="group-name">–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã:</label>
                    <input type="text" id="group-name" required maxlength="100">
                </div>
                <div class="form-group">
                    <label for="group-description">–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):</label>
                    <textarea id="group-description" rows="3" maxlength="500"></textarea>
                </div>
                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="group-private">
                        <span class="checkmark"></span>
                        –ü—Ä–∏–≤–∞—Ç–Ω–∞—è –≥—Ä—É–ø–ø–∞
                    </label>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-cancel">–û—Ç–º–µ–Ω–∞</button>
                    <button type="submit" class="btn-primary">–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // üß≠ –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const CURRENT_USER = {
        uuid: "{{ session.get('user_uuid') }}",
        username: "{{ session.get('user_username') }}"
    };

    document.addEventListener('DOMContentLoaded', () => {
        if (!CURRENT_USER.uuid) {
            window.location.href = '/auth';
            return;
        }
        initializeChat(); // –§—É–Ω–∫—Ü–∏—è –∏–∑ app.js
    });
</script>
{% endblock %}
